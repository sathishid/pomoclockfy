# Copilot Instructions for Pomoclockfy

- **Big picture**: React (CRA) frontend in [pomoclockify-frontend/src/App.js](pomoclockify-frontend/src/App.js) runs fully in-browser with session/local storage fallback; Spring Boot + MySQL backend in [pomoclockfy-backend](pomoclockfy-backend) provides REST APIs for tasks and settings but app must tolerate backend being offline.
- **Frontend data flow**: App state lives in [pomoclockify-frontend/src/App.js](pomoclockify-frontend/src/App.js); timer UI in [pomoclockify-frontend/src/components/Timer.js](pomoclockify-frontend/src/components/Timer.js); settings modal and data management in [pomoclockify-frontend/src/components/Settings.js](pomoclockify-frontend/src/components/Settings.js).
- **API client**: Axios wrapper in [pomoclockify-frontend/src/services/api.js](pomoclockify-frontend/src/services/api.js) uses `REACT_APP_API_URL` (defaults to http://localhost:8080). Session type mapping is asymmetric: frontend uses `work|break|longBreak`, backend expects `WORK|BREAK|LONG_BREAK` enums.
- **Offline-first logic**: On load, `checkServerHealth` gates whether to pull from backend or localStorage; changes always persist to localStorage, and when online they also sync to backend. Keep optimistic updates intact (tasks added locally first, server write attempted afterward).
- **Timer behavior**: Timer stores end timestamp to survive tab throttling; audio loads lazily and falls back to Web Audio beep if `/alarm.wav` fails.
- **Task shape**: Frontend tasks have `{id, task, sessionType, startTime, endTime, duration}` with Date objects for times; backend `Task` entity at [pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/Task.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/Task.java) requires all fields non-null and uses `SessionType` enum from [pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/SessionType.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/SessionType.java).
- **Settings shape**: Backend defaults live in [pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/Settings.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/entity/Settings.java) (25/5/15 minutes, sessionsCompleted=0). React stores same fields and keeps `sessionsCompleted` in sync with backend when available.
- **REST endpoints**: Tasks and settings controllers are in [pomoclockfy-backend/src/main/java/com/pomoclockfy/controller/TaskController.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/controller/TaskController.java) and [pomoclockfy-backend/src/main/java/com/pomoclockfy/controller/SettingsController.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/controller/SettingsController.java); tasks are ordered newest-first, support today filters and search, and `getTotalDurationForToday` aggregates minutes.
- **Persistence**: MySQL URL/user/password are hardcoded for local dev in [pomoclockfy-backend/src/main/resources/application.properties](pomoclockfy-backend/src/main/resources/application.properties); schema uses `spring.jpa.hibernate.ddl-auto=update` plus bootstrap SQL in [pomoclockfy-backend/src/main/resources/schema.sql](pomoclockfy-backend/src/main/resources/schema.sql).
- **CORS**: Allowed origins include `http://localhost:3000`/`3001` and any `http://localhost:*` via [pomoclockfy-backend/src/main/java/com/pomoclockfy/config/CorsConfig.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/config/CorsConfig.java); controllers also annotate `@CrossOrigin("http://localhost:3000")`.
- **Time handling**: Backend sets `spring.jackson.time-zone=UTC` and ISO format; store/send datetimes as ISO strings. Entities set `createdAt/updatedAt` at construction and `@PreUpdate`, so clients should not omit timestamps when bypassing normal constructors.
- **Repositories**: Query helpers live in [pomoclockfy-backend/src/main/java/com/pomoclockfy/repository/TaskRepository.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/repository/TaskRepository.java) (search, today duration, date ranges) and [pomoclockfy-backend/src/main/java/com/pomoclockfy/repository/SettingsRepository.java](pomoclockfy-backend/src/main/java/com/pomoclockfy/repository/SettingsRepository.java) (singleton settings row).
- **Build/run**:
  - Backend: from `pomoclockfy-backend`, run `mvn spring-boot:run`; requires MySQL running and credentials matching `application.properties`.
  - Frontend: from `pomoclockify-frontend`, run `npm install` then `npm start`; set `REACT_APP_API_URL` to point at backend if not localhost.
- **Data storage contracts**: Browser uses localStorage keys `pomoclockfy-tasks` and `pomoclockfy-settings`. Clearing data via Settings modal resets timers and local cache but does not delete backend tasks (no bulk delete endpoint).
- **UI conventions**: Pagination for history is date-ranged (7-day windows) rather than page size; “Done” saves a task only when a task name and startTime exist; session tabs disabled while running.
- **Error handling**: API wrapper logs in dev mode, retries via `retryAPICall`, and offers `handleAPIError` fallback hook; Timer uses background-safe ticking to avoid missing completion events.
- **When adding backend endpoints**: mirror CORS config, return DTOs compatible with `api.js` mappers, and ensure enum casing stays `WORK/BREAK/LONG_BREAK`. For new persisted fields, add mapping in `mapTaskFromBackend` and localStorage serialization in App state.
- **When extending frontend storage**: preserve the offline-first pattern—write to localStorage immediately, attempt server sync if `serverAvailable`, and keep date strings converted to `Date` objects on load.
- **Testing**: Backend tests run with `mvn test`; frontend uses CRA defaults (`npm test`) but no current suites—add lightweight component/API tests if modifying Timer/Settings behaviors.
- **Deployment notes**: Frontend Docker builds to Nginx in [pomoclockify-frontend/Dockerfile](pomoclockify-frontend/Dockerfile); docker-compose currently runs frontend only on port 8080. Full-stack Docker is not yet wired.
- **AWS static hosting**: For S3 + CloudFront + Route53 deploys, build with `npm run build`, upload `pomoclockify-frontend/build/**` to the S3 bucket (keep `index.html` at root), set CloudFront origin to the bucket, default root object `index.html`, and add an error page rule to serve `index.html` for 403/404 to support SPA routing. Invalidate `/*` after uploads. Point the Route53 record (A/AAAA) to the CloudFront distribution; if the backend is exposed elsewhere, set `REACT_APP_API_URL` to that HTTPS origin before building.

If anything above is unclear or missing, tell me which section to expand or correct.
